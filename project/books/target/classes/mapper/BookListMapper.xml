<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ouranservice.DAO.BookListDAO">
    <resultMap id="briefList" type="com.ouranservice.entity.BookList">
        <id property="bookListId" column="book_List_Id"/>                           <!-- Id -->
        <result property="bookListName" column="book_List_Name"/>                   <!-- 书单名 -->
        <result property="bookListIntroduction" column="book_List_Introduction"/>   <!-- 书单简介 -->
    </resultMap>

    <resultMap id="detailList" type="com.ouranservice.entity.BookList">
        <id property="bookListId" column="book_List_Id"/>                           <!-- Id -->
        <result property="bookListName" column="book_List_Name"/>                   <!-- 书单名 -->
        <result property="bookListIntroduction" column="book_List_Introduction"/>   <!-- 书单简介 -->
        <!-- 书单内的书籍信息 -->
        <collection property="bookList"
                    column="bookListId=book_List_Id"
                    ofType="com.ouranservice.entity.Book"
                    select="com.ouranservice.DAO.BookListDAO.getBookByBookListId">

            <id property="bookId" column="book_Id"/>                                <!-- Id -->
            <result property="bookName" column="book_Name"/>                        <!-- 书名 -->
            <result property="bookWriter" column="book_Writer"/>                    <!-- 作者 -->
            <result property="bookPublishTime" column="book_Publish_Time"/>         <!-- 出版时间 -->
            <result property="bookPublishArea" column="book_Publish_Area"/>         <!-- 出版区域 -->
            <result property="bookPic" column="book_Pic"/>                          <!-- 封面 -->
            <result property="bookIntroduction" column="book_Introduction"/>        <!-- 简介 -->
            <result property="bookStar" column="book_Star"/>                        <!-- 评分 -->
            <result property="bookLikeCount" column="book_Like_Count"/>             <!-- 点赞数 -->
            <!-- 获取书籍类型信息 -->
            <collection property="bookTypes"
                        column="bookId=book_Id"
                        ofType="com.ouranservice.entity.BookTypes"
                        select="com.ouranservice.DAO.BookTypeDAO.getTypesByBookId">
                <result property="typeId" column="typeId"/>
                <result property="typeName" column="typeName"/>
            </collection>
        </collection>
    </resultMap>

    <!-- 根据Id查询书单具体信息 -->
    <select id="getBookListById" resultMap="detailList">
        select * from Book_List where book_List_Id = #{bookListId}
    </select>

    <!-- 获取初始书单(5个) -->
    <select id="getNewList" resultMap="briefList">
        select * from Book_List order by book_List_Id DESC Limit 0,5
    </select>

    <!-- 分页查询全部书单信息(按照ID倒序) -->
    <select id="getAll" resultMap="briefList">
        select * from Book_List order by book_List_Id DESC Limit #{pageNumber},10
    </select>

    <!-- 根据bookListId获取书单中的书籍信息 -->
    <select id="getBookByBookListId" resultType="com.ouranservice.entity.Book">
        select
            b.book_id,
            b.book_name,
            b.book_writer,
            b.book_Publish_Time,
            b.book_Publish_Area,
            b.book_Pic,
            b.book_Introduction,
            b.book_Star,
            b.book_Like_Count
        from
            Book_To_List btl, Book b
        where
            btl.book_List_Id = #{bookListId} and b.book_id = btl.book_id
        order by
            book_star DESC,book_Id ASC
    </select>
</mapper>